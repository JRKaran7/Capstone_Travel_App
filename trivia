import streamlit as st
import pandas as pd
import random

# Load questions from CSV
def load_questions(file_path):
    return pd.read_csv(file_path).to_dict(orient='records')

# Filter questions based on category
def filter_questions_by_category(questions, category):
    if category == "All":
        return random.sample(questions, min(10, len(questions)))
    return [q for q in questions if q["Category"] == category][:10]

# Streamlit UI
st.title("Seven Sisters Trivia Challenge")

# Load data
FILE_PATH = "trivia.csv"  # Update with actual path
questions = load_questions(FILE_PATH)

# Select category
categories = ["All"] + list(set(q["Category"] for q in questions))
selected_category = st.selectbox("Which Seven Sister would you like to answer questions about?", categories)

if 'game_started' not in st.session_state:
    st.session_state.game_started = False
    st.session_state.questions = []
    st.session_state.current_question_index = 0
    st.session_state.score = 0
    st.session_state.timer_duration = 20
    st.session_state.time_left = 20
    st.session_state.correct_index = None

if st.button("Start Game"):
    st.session_state.game_started = True
    st.session_state.questions = filter_questions_by_category(questions, selected_category)
    st.session_state.current_question_index = 0
    st.session_state.score = 0
    st.session_state.time_left = st.session_state.timer_duration
    st.session_state.correct_index = None

if st.session_state.game_started:
    if st.session_state.current_question_index < len(st.session_state.questions):
        question_data = st.session_state.questions[st.session_state.current_question_index]
        st.write(f"**Question {st.session_state.current_question_index + 1}:** {question_data['Question']}")
        
        options = [("A", question_data['OptionA']), ("B", question_data['OptionB']),
                   ("C", question_data['OptionC']), ("D", question_data['OptionD'])]
        random.shuffle(options)
        correct_option = next(opt[0] for opt in options if opt[0] == question_data['Answer'])
        
        selected_answer = st.radio("Choose an answer:", [opt[1] for opt in options], index=None)
        
        if selected_answer is not None:
            chosen_index = [opt[1] for opt in options].index(selected_answer)
            if options[chosen_index][0] == correct_option:
                st.session_state.score += 1
                st.success("Correct! ðŸŽ‰")
            else:
                st.error(f"Wrong! Correct answer: {options[[opt[0] for opt in options].index(correct_option)][1]}")
            
            if st.button("Next Question"):
                st.session_state.current_question_index += 1
                st.experimental_rerun()
    else:
        st.write("## Game Over!")
        st.write(f"Your final score: {st.session_state.score}/{len(st.session_state.questions)}")
        if st.button("Play Again"):
            st.session_state.game_started = False
            st.experimental_rerun()
